{
  "hash": "92a561c5134d21be32a7716c558c44a4",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: 'Z Score Classifier'\nformat:\n  html:\n    theme: darkly\n---\n\n## Preparing data and motivation\n\n::: {#940972ae .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport os\nimport random\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom great_tables import GT, md\n\nfrom scipy.signal import detrend\n\ntest_file_names = os.listdir(\"test/\")\ntest_file_names.sort()\n\ntest_files = []\n#for file in test_file_names:\n#    test_files.append(pd.read_csv(f\"test/{file}\", sep=\";\"))\n\n\n#NOTE: I'm changing the way the data is imported by preprocessing\n# it while being imported. In the official colab, this should be done separately\nfor file in test_file_names:\n    data = pd.read_csv(f\"test/{file}\", sep=\";\")\n    data['Value1'] = detrend(data['Value1'])\n    test_files.append(data)\n\n\ntrain_file_names = os.listdir('train/')\ntrain_files = []\nfor train in train_file_names:\n  train_files.append(pd.read_csv(f'train/{file}',sep=';'))\n```\n:::\n\n\nThe test data is **normally distributed** meaning normal outlier detection \ntechniques like `z scores` and `IQR` is applicable.\n\n### The Model\n\n::: {#9c947ba7 .cell execution_count=2}\n``` {.python .cell-code}\nfrom sklearn.base import BaseEstimator, ClassifierMixin\nfrom sklearn.metrics import recall_score\nfrom sklearn.metrics import mean_squared_error, mean_absolute_error\n\nclass StatsModel(BaseEstimator, ClassifierMixin):\n  \"\"\"\n  Ensemble stats outlier classifier using:\n  - IQR\n  - Normal z_scores\n  - Rolling z_scores\n  - Mean Absolute Deviation\n  \"\"\"\n  def __init__(self, w_smooth=51, w = 61,\n               iqr_threshold = 1.5,\n               mad_threshold = 2.465,\n               normal_z_threshold = 2,\n               rolling_z_threshold = 2,\n               metric_consensus =3):\n    \n    self.w = w\n    self.w_smooth = w_smooth\n    self.iqr_threshold = iqr_threshold\n    self.mad_threshold = mad_threshold\n    self.normal_z_threshold = normal_z_threshold\n    self.rolling_z_threshold = rolling_z_threshold\n    self.metric_consensus = metric_consensus\n\n\n  def _determine_rolling_z_mask(self, X :np.array) -> np.array:\n    \n    k = np.ones(self.w_smooth) / self.w_smooth\n    smooth = np.convolve(X, k, mode='same') \n\n    # I'm quite sure this step makes it less applicable for machine learning so\n    # its not used in fit\n    resid = X- smooth\n    kw = np.ones(self.w) / self.w\n    mu = np.convolve(resid, kw, mode='same')\n    mu2 = np.convolve(resid * resid, kw, mode='same')\n    var = np.maximum(mu2 - mu*mu, 1e-08)\n    sigma= np.sqrt(var)\n\n    z_rolling = np.abs((resid - mu) / (sigma + 1e-08))\n    return np.abs(z_rolling > self.rolling_z_threshold)\n\n  def fit(self, X : np.array, y=None) -> None:\n    self.iqr_ = np.quantile(X,0.75) - np.quantile(X,0.25)\n    self.mean_ = np.mean(X)\n    self.std_ = np.std(X)\n    self.median_ = np.median(X)\n    self.mad_ = np.sum(np.abs(X - self.mean_)) / len(X)\n\n    self.iqr_ub_ = self.mean_ + self.iqr_threshold * self.iqr_\n    self.iqr_lb_ = self.mean_ - self.iqr_threshold * self.iqr_ \n    return self\n    \n  def predict(self, X = None) -> np.array:\n    \n    IQR_mask = (X > self.iqr_ub_) | (X < self.iqr_lb_)\n    MAD_mask = np.abs(X - self.median_) > self.mad_ * self.mad_threshold\n    Normal_Z_Mask = np.abs((X - self.mean_) / self.std_) > self.normal_z_threshold\n    Rolling_Z_Mask = self._determine_rolling_z_mask(X)\n    \n    mask_df = pd.DataFrame({\n      'IQR' : IQR_mask,\n      \"MAD\" : MAD_mask,\n      'Normal_z' : Normal_Z_Mask,\n      'Rolling_z' : Rolling_Z_Mask \n    })\n\n    mask_df['outlier'] = mask_df.sum(axis=1) >= self.metric_consensus\n    return mask_df['outlier'].to_numpy()\n\n  def score(self, X , y_true) -> float:\n    y_pred = self.predict(X)\n    \n    return recall_score(y_true, y_pred)\n\n```\n:::\n\n\n## Helper Functions\n\n::: {#c791c089 .cell execution_count=3}\n``` {.python .cell-code}\nfrom benchmarking import Benchmarking\nimport time\n\n\ndef run_benchmark(model,show_printout=True):\n  benchmark_df = pd.DataFrame()\n  file_no = 1\n  for df in test_files:\n    if show_printout:\n      print(f'\\n=========================File {file_no}==========================\\n')\n    model = model\n    X = df['Value1']\n    y_true = df['Labels']\n    model.fit(X)\n    y_pred = model.predict(X)\n    results = Benchmarking.evaluate_model(y_true, y_pred,show_printout=show_printout)\n    results = results.rename(columns={'Score' : f'File {file_no}'})\n    benchmark_df = pd.concat([benchmark_df, results],axis=1)                         \n    file_no += 1\n\n  return benchmark_df\n\ndef create_benchmark_table(benchmark_df: pd.DataFrame,\n                           model_name :str = \"Stats Model\" ,\n                           subtitle: str = \"results **before hyperparameter turning**\") -> None:\n  \n  totals = benchmark_df.sum(axis=1) / 10\n  totals = totals.apply(lambda x: round(x,2))\n\n  totals = totals.to_frame().transpose()\n  totals['group'] = 'AGGREGATE'\n  benchmark_df = benchmark_df.transpose()\n  benchmark_df['group'] = 'File'\n  benchmark_df = pd.concat([benchmark_df, totals])\n\n  benchmark_df = benchmark_df.reset_index().rename(columns={'index': 'File'})\n  benchmark_df\n  (\n    GT(benchmark_df)\n    .tab_header(title=md(f'Benchmark Results: **{model_name}**'),\n                subtitle=md(subtitle))\n    .tab_source_note(md('See benchmarks for how penalised group accuracy is calculated'))\n    .tab_stub(rowname_col='File',groupname_col='group')\n  ).show()\n```\n:::\n\n\n## Benchmarking Time complexity\n\n::: {#b1b74eee .cell execution_count=4}\n``` {.python .cell-code}\nstart = time.perf_counter()\nms = []\nfor epoch in range(1,1000):\n  start = time.perf_counter()\n  model = StatsModel()\n  run_benchmark(model,show_printout=False)\n  end = time.perf_counter()\n  ms.append((end-start))\nend = time.perf_counter()\nprint('Time for 1000 epochs', end-start)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTime for 1000 epochs 0.1343959019995964\n```\n:::\n:::\n\n\n::: {#15623534 .cell execution_count=5}\n``` {.python .cell-code}\nplt.plot(ms)\nplt.title('Total execution time for 10 Files')\nplt.xlabel('Epoch')\nplt.ylabel('Execution Time(in seconds)')\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-6-output-1.png){width=597 height=449}\n:::\n:::\n\n\nThe execution time varies from 24 ms to 300 ms meaning we can tune this model\nfor thousands of iterations to determine the optimal parameters\n\n## Base Benchmark\n\n::: {#6104b594 .cell execution_count=6}\n``` {.python .cell-code}\nbenchmark_df = run_benchmark(StatsModel())\ncreate_benchmark_table(benchmark_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n=========================File 1==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 2==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 3==========================\n\n12 anomaly groups identified\n10 anomaly groups identified\nModel predicts 2 more than 10\nModel predicts 2 more than 10\n\n=========================File 4==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 5==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 6==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 7==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 8==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 9==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 10==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div id=\"flheldnxjj\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#flheldnxjj table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#flheldnxjj thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#flheldnxjj p { margin: 0; padding: 0; }\n #flheldnxjj .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #flheldnxjj .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #flheldnxjj .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #flheldnxjj .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #flheldnxjj .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #flheldnxjj .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #flheldnxjj .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #flheldnxjj .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #flheldnxjj .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #flheldnxjj .gt_column_spanner_outer:first-child { padding-left: 0; }\n #flheldnxjj .gt_column_spanner_outer:last-child { padding-right: 0; }\n #flheldnxjj .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #flheldnxjj .gt_spanner_row { border-bottom-style: hidden; }\n #flheldnxjj .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #flheldnxjj .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }\n #flheldnxjj .gt_from_md> :first-child { margin-top: 0; }\n #flheldnxjj .gt_from_md> :last-child { margin-bottom: 0; }\n #flheldnxjj .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }\n #flheldnxjj .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }\n #flheldnxjj .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #flheldnxjj .gt_row_group_first td { border-top-width: 2px; }\n #flheldnxjj .gt_row_group_first th { border-top-width: 2px; }\n #flheldnxjj .gt_striped { background-color: rgba(128,128,128,0.05); }\n #flheldnxjj .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #flheldnxjj .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #flheldnxjj .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #flheldnxjj .gt_left { text-align: left; }\n #flheldnxjj .gt_center { text-align: center; }\n #flheldnxjj .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #flheldnxjj .gt_font_normal { font-weight: normal; }\n #flheldnxjj .gt_font_bold { font-weight: bold; }\n #flheldnxjj .gt_font_italic { font-style: italic; }\n #flheldnxjj .gt_super { font-size: 65%; }\n #flheldnxjj .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #flheldnxjj .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_title gt_font_normal\">Benchmark Results: <strong>Stats Model</strong></td>\n  </tr>\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\">results <strong>before hyperparameter turning</strong></td>\n  </tr>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Accuracy\">Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Precision\">Precision</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Recall\">Recall</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Balanced-Accuracy\">Balanced Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Group-Accuracy\">Group Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Penalised-Group-Accuracy\">Penalised Group Accuracy</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"7\">File</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 1</th>\n    <td class=\"gt_row gt_right\">98.63</td>\n    <td class=\"gt_row gt_right\">99.87</td>\n    <td class=\"gt_row gt_right\">84.75</td>\n    <td class=\"gt_row gt_right\">92.37</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 2</th>\n    <td class=\"gt_row gt_right\">96.66</td>\n    <td class=\"gt_row gt_right\">99.86</td>\n    <td class=\"gt_row gt_right\">68.79</td>\n    <td class=\"gt_row gt_right\">84.39</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n    <td class=\"gt_row gt_right\">72.73</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 3</th>\n    <td class=\"gt_row gt_right\">96.64</td>\n    <td class=\"gt_row gt_right\">99.78</td>\n    <td class=\"gt_row gt_right\">57.27</td>\n    <td class=\"gt_row gt_right\">78.63</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n    <td class=\"gt_row gt_right\">58.33</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 4</th>\n    <td class=\"gt_row gt_right\">97.84</td>\n    <td class=\"gt_row gt_right\">99.83</td>\n    <td class=\"gt_row gt_right\">73.26</td>\n    <td class=\"gt_row gt_right\">86.62</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 5</th>\n    <td class=\"gt_row gt_right\">98.99</td>\n    <td class=\"gt_row gt_right\">99.76</td>\n    <td class=\"gt_row gt_right\">80.31</td>\n    <td class=\"gt_row gt_right\">90.15</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 6</th>\n    <td class=\"gt_row gt_right\">97.04</td>\n    <td class=\"gt_row gt_right\">99.86</td>\n    <td class=\"gt_row gt_right\">70.62</td>\n    <td class=\"gt_row gt_right\">85.3</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 7</th>\n    <td class=\"gt_row gt_right\">98.18</td>\n    <td class=\"gt_row gt_right\">99.68</td>\n    <td class=\"gt_row gt_right\">77.81</td>\n    <td class=\"gt_row gt_right\">88.89</td>\n    <td class=\"gt_row gt_right\">100.0</td>\n    <td class=\"gt_row gt_right\">90.91</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 8</th>\n    <td class=\"gt_row gt_right\">96.0</td>\n    <td class=\"gt_row gt_right\">99.81</td>\n    <td class=\"gt_row gt_right\">57.37</td>\n    <td class=\"gt_row gt_right\">78.68</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n    <td class=\"gt_row gt_right\">63.64</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 9</th>\n    <td class=\"gt_row gt_right\">96.81</td>\n    <td class=\"gt_row gt_right\">99.76</td>\n    <td class=\"gt_row gt_right\">56.62</td>\n    <td class=\"gt_row gt_right\">78.3</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 10</th>\n    <td class=\"gt_row gt_right\">97.57</td>\n    <td class=\"gt_row gt_right\">99.87</td>\n    <td class=\"gt_row gt_right\">75.99</td>\n    <td class=\"gt_row gt_right\">87.99</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"7\">AGGREGATE</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">0</th>\n    <td class=\"gt_row gt_right\">97.44</td>\n    <td class=\"gt_row gt_right\">99.81</td>\n    <td class=\"gt_row gt_right\">70.28</td>\n    <td class=\"gt_row gt_right\">85.13</td>\n    <td class=\"gt_row gt_right\">85.0</td>\n    <td class=\"gt_row gt_right\">79.11</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"7\">See benchmarks for how penalised group accuracy is calculated</td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\n### Base Benchmark with different grouping hyperparameters\n\nThe grouping function used for anomalous regions has two hyperparameters:\n\n- **merge_tolerance**\n  - acceptable gap between predicted anomalous regions for when a merge is \n    appropriate\n- **noise_tolerance**\n  - minimum length of an anomalous region(end - start) for it to be classified \n    as an anomalous region\n\n\n\n\nThe group accuracy is penalised if precision or recall is very high. Given each\nset has a recall of 100%, we can hyperparameter tune the model to maximize \nrecall to get these two metrics closer together.\n\nGiven precision is 100% (no false positives) this indicates all true anomalies\nare deteced by the model. The problem is that there is false negatives in the \nmodel indicating multiple false indications of anomalous regions. \n\n### Hyperparameter Tuning for Penalised Group Accuracy\n\n::: {#cb443b29 .cell execution_count=7}\n``` {.python .cell-code}\nfrom sklearn.model_selection import GridSearchCV, RandomizedSearchCV\nfrom tqdm import tqdm\n\nparam_grid = {\n    \"w_smooth\": [31, 51, 71, 91, 111, 131, 151, 171],          \n    \"w\": [41, 61, 81, 101, 121, 141, 161, 181],                \n    \"iqr_threshold\": [1.5, 1.75, 2],                   \n    \"mad_threshold\": [ 2.2, 2.465, 2.7, 3],                  \n    \"normal_z_threshold\": [2.25, 2.5, 3],         \n    \"rolling_z_threshold\": [2.0, 2.25, 2.5],\n    \"metric_consensus\": [3, 4]                          \n}\ncombined = pd.concat(test_files)\n\ndef calculate_estimated_tuning_time(params: dict, cv :int):\n  total_iterations = 1\n  for key, value in params.items():\n    total_iterations *= len(value)\n  print(total_iterations)\n  print('Estimated Tuning Time', (total_iterations / 16)*cv, 'seconds')\n\ncalculate_estimated_tuning_time(param_grid,5)\n\nimport itertools\nimport numpy as np\n\ndef grid_search(model, X, y, param_grid):\n    best_score = -np.inf\n    best_params = {}\n    for combination in tqdm(itertools.product(*param_grid.values()),desc='Iterations'):\n        params = dict(zip(param_grid.keys(), combination))\n        model.set_params(**params)\n        model.fit(X, y)\n        score = model.score(X, y)\n        if score > best_score:\n            best_score = score\n            best_params = params\n    return best_params, best_score\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n13824\nEstimated Tuning Time 4320.0 seconds\n```\n:::\n:::\n\n\n::: {#7f625256 .cell execution_count=8}\n``` {.python .cell-code}\nimport os\ngrid = GridSearchCV(StatsModel(),\n                    param_grid=param_grid,\n                    cv=5,\n                    verbose=1,\n                    n_jobs=-1,\n                    scoring='balanced_accuracy')\n#grid.fit(combined['Value1'],combined[\"Labels\"])\n#os.system(\"ffplay ~/Music/notify.mp3\") # I use this to know when its done executing\n```\n:::\n\n\n::: {#6abcad22 .cell execution_count=9}\n``` {.python .cell-code}\n#grid.best_params_\n```\n:::\n\n\n::: {#7bb1755d .cell execution_count=10}\n``` {.python .cell-code}\nbest_recall_params = {'iqr_threshold': 1.5,\n                      'mad_threshold': 2.2,\n                      'metric_consensus': 3,\n                      'normal_z_threshold': 2.25,\n                      'rolling_z_threshold': 2.0,\n                      'w': 41,\n                      'w_smooth': 31}\n\n\nbest_balanced_acc_params = {'iqr_threshold': 1.5,\n                            'mad_threshold': 3,\n                            'metric_consensus': 3,\n                            'normal_z_threshold': 2.25,\n                            'rolling_z_threshold': 2.0,\n                            'w': 41,\n                            'w_smooth': 31}\n\nbest_recall_clf = StatsModel()\nbest_recall_clf.set_params(**best_recall_params)\n\nbenchmark_df = run_benchmark(best_recall_clf)\ncreate_benchmark_table(benchmark_df,model_name='Z_Score Model',\n                       subtitle=\"results **after hyperparameter tuning for recall**\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n=========================File 1==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 2==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 3==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 4==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 5==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 6==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 7==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 8==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 9==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 10==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div id=\"wxlpipmxfx\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#wxlpipmxfx table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#wxlpipmxfx thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#wxlpipmxfx p { margin: 0; padding: 0; }\n #wxlpipmxfx .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #wxlpipmxfx .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #wxlpipmxfx .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #wxlpipmxfx .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #wxlpipmxfx .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #wxlpipmxfx .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #wxlpipmxfx .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #wxlpipmxfx .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #wxlpipmxfx .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #wxlpipmxfx .gt_column_spanner_outer:first-child { padding-left: 0; }\n #wxlpipmxfx .gt_column_spanner_outer:last-child { padding-right: 0; }\n #wxlpipmxfx .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #wxlpipmxfx .gt_spanner_row { border-bottom-style: hidden; }\n #wxlpipmxfx .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #wxlpipmxfx .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }\n #wxlpipmxfx .gt_from_md> :first-child { margin-top: 0; }\n #wxlpipmxfx .gt_from_md> :last-child { margin-bottom: 0; }\n #wxlpipmxfx .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }\n #wxlpipmxfx .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }\n #wxlpipmxfx .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #wxlpipmxfx .gt_row_group_first td { border-top-width: 2px; }\n #wxlpipmxfx .gt_row_group_first th { border-top-width: 2px; }\n #wxlpipmxfx .gt_striped { background-color: rgba(128,128,128,0.05); }\n #wxlpipmxfx .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #wxlpipmxfx .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #wxlpipmxfx .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #wxlpipmxfx .gt_left { text-align: left; }\n #wxlpipmxfx .gt_center { text-align: center; }\n #wxlpipmxfx .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #wxlpipmxfx .gt_font_normal { font-weight: normal; }\n #wxlpipmxfx .gt_font_bold { font-weight: bold; }\n #wxlpipmxfx .gt_font_italic { font-style: italic; }\n #wxlpipmxfx .gt_super { font-size: 65%; }\n #wxlpipmxfx .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #wxlpipmxfx .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_title gt_font_normal\">Benchmark Results: <strong>Z_Score Model</strong></td>\n  </tr>\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\">results <strong>after hyperparameter tuning for recall</strong></td>\n  </tr>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Accuracy\">Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Precision\">Precision</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Recall\">Recall</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Balanced-Accuracy\">Balanced Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Group-Accuracy\">Group Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Penalised-Group-Accuracy\">Penalised Group Accuracy</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"7\">File</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 1</th>\n    <td class=\"gt_row gt_right\">98.54</td>\n    <td class=\"gt_row gt_right\">99.87</td>\n    <td class=\"gt_row gt_right\">83.74</td>\n    <td class=\"gt_row gt_right\">91.87</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 2</th>\n    <td class=\"gt_row gt_right\">96.49</td>\n    <td class=\"gt_row gt_right\">99.72</td>\n    <td class=\"gt_row gt_right\">67.29</td>\n    <td class=\"gt_row gt_right\">83.63</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 3</th>\n    <td class=\"gt_row gt_right\">96.51</td>\n    <td class=\"gt_row gt_right\">99.77</td>\n    <td class=\"gt_row gt_right\">55.61</td>\n    <td class=\"gt_row gt_right\">77.8</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n    <td class=\"gt_row gt_right\">63.64</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 4</th>\n    <td class=\"gt_row gt_right\">97.82</td>\n    <td class=\"gt_row gt_right\">99.83</td>\n    <td class=\"gt_row gt_right\">73.01</td>\n    <td class=\"gt_row gt_right\">86.5</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 5</th>\n    <td class=\"gt_row gt_right\">98.9</td>\n    <td class=\"gt_row gt_right\">99.5</td>\n    <td class=\"gt_row gt_right\">78.74</td>\n    <td class=\"gt_row gt_right\">89.36</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 6</th>\n    <td class=\"gt_row gt_right\">96.86</td>\n    <td class=\"gt_row gt_right\">99.86</td>\n    <td class=\"gt_row gt_right\">68.82</td>\n    <td class=\"gt_row gt_right\">84.41</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 7</th>\n    <td class=\"gt_row gt_right\">98.11</td>\n    <td class=\"gt_row gt_right\">99.68</td>\n    <td class=\"gt_row gt_right\">76.94</td>\n    <td class=\"gt_row gt_right\">88.46</td>\n    <td class=\"gt_row gt_right\">100.0</td>\n    <td class=\"gt_row gt_right\">90.91</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 8</th>\n    <td class=\"gt_row gt_right\">95.82</td>\n    <td class=\"gt_row gt_right\">99.62</td>\n    <td class=\"gt_row gt_right\">55.56</td>\n    <td class=\"gt_row gt_right\">77.77</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 9</th>\n    <td class=\"gt_row gt_right\">96.76</td>\n    <td class=\"gt_row gt_right\">99.52</td>\n    <td class=\"gt_row gt_right\">56.07</td>\n    <td class=\"gt_row gt_right\">78.02</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 10</th>\n    <td class=\"gt_row gt_right\">97.38</td>\n    <td class=\"gt_row gt_right\">99.87</td>\n    <td class=\"gt_row gt_right\">74.11</td>\n    <td class=\"gt_row gt_right\">87.05</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"7\">AGGREGATE</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">0</th>\n    <td class=\"gt_row gt_right\">97.32</td>\n    <td class=\"gt_row gt_right\">99.72</td>\n    <td class=\"gt_row gt_right\">68.99</td>\n    <td class=\"gt_row gt_right\">84.49</td>\n    <td class=\"gt_row gt_right\">85.0</td>\n    <td class=\"gt_row gt_right\">80.18</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"7\">See benchmarks for how penalised group accuracy is calculated</td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\n::: {#242299dc .cell execution_count=11}\n``` {.python .cell-code}\nbest_balacc_clf = StatsModel().set_params(**best_balanced_acc_params)\ncreate_benchmark_table(run_benchmark(best_balacc_clf),model_name='Z Score Model',\n                       subtitle=\"results **after hyperparameter tuning for balanced accuracy**\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n=========================File 1==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 2==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 3==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 4==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 5==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 6==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 7==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 8==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 9==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 10==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div id=\"qyisptssxi\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#qyisptssxi table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#qyisptssxi thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#qyisptssxi p { margin: 0; padding: 0; }\n #qyisptssxi .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #qyisptssxi .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #qyisptssxi .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #qyisptssxi .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #qyisptssxi .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #qyisptssxi .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #qyisptssxi .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #qyisptssxi .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #qyisptssxi .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #qyisptssxi .gt_column_spanner_outer:first-child { padding-left: 0; }\n #qyisptssxi .gt_column_spanner_outer:last-child { padding-right: 0; }\n #qyisptssxi .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #qyisptssxi .gt_spanner_row { border-bottom-style: hidden; }\n #qyisptssxi .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #qyisptssxi .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }\n #qyisptssxi .gt_from_md> :first-child { margin-top: 0; }\n #qyisptssxi .gt_from_md> :last-child { margin-bottom: 0; }\n #qyisptssxi .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }\n #qyisptssxi .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }\n #qyisptssxi .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #qyisptssxi .gt_row_group_first td { border-top-width: 2px; }\n #qyisptssxi .gt_row_group_first th { border-top-width: 2px; }\n #qyisptssxi .gt_striped { background-color: rgba(128,128,128,0.05); }\n #qyisptssxi .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #qyisptssxi .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #qyisptssxi .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #qyisptssxi .gt_left { text-align: left; }\n #qyisptssxi .gt_center { text-align: center; }\n #qyisptssxi .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #qyisptssxi .gt_font_normal { font-weight: normal; }\n #qyisptssxi .gt_font_bold { font-weight: bold; }\n #qyisptssxi .gt_font_italic { font-style: italic; }\n #qyisptssxi .gt_super { font-size: 65%; }\n #qyisptssxi .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #qyisptssxi .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_title gt_font_normal\">Benchmark Results: <strong>Z Score Model</strong></td>\n  </tr>\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\">results <strong>after hyperparameter tuning for balanced accuracy</strong></td>\n  </tr>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Accuracy\">Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Precision\">Precision</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Recall\">Recall</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Balanced-Accuracy\">Balanced Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Group-Accuracy\">Group Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Penalised-Group-Accuracy\">Penalised Group Accuracy</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"7\">File</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 1</th>\n    <td class=\"gt_row gt_right\">98.55</td>\n    <td class=\"gt_row gt_right\">100.0</td>\n    <td class=\"gt_row gt_right\">83.74</td>\n    <td class=\"gt_row gt_right\">91.87</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 2</th>\n    <td class=\"gt_row gt_right\">96.51</td>\n    <td class=\"gt_row gt_right\">100.0</td>\n    <td class=\"gt_row gt_right\">67.29</td>\n    <td class=\"gt_row gt_right\">83.65</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 3</th>\n    <td class=\"gt_row gt_right\">96.52</td>\n    <td class=\"gt_row gt_right\">100.0</td>\n    <td class=\"gt_row gt_right\">55.61</td>\n    <td class=\"gt_row gt_right\">77.81</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n    <td class=\"gt_row gt_right\">63.64</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 4</th>\n    <td class=\"gt_row gt_right\">97.83</td>\n    <td class=\"gt_row gt_right\">100.0</td>\n    <td class=\"gt_row gt_right\">73.01</td>\n    <td class=\"gt_row gt_right\">86.5</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 5</th>\n    <td class=\"gt_row gt_right\">98.91</td>\n    <td class=\"gt_row gt_right\">99.75</td>\n    <td class=\"gt_row gt_right\">78.74</td>\n    <td class=\"gt_row gt_right\">89.36</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 6</th>\n    <td class=\"gt_row gt_right\">96.87</td>\n    <td class=\"gt_row gt_right\">100.0</td>\n    <td class=\"gt_row gt_right\">68.82</td>\n    <td class=\"gt_row gt_right\">84.41</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 7</th>\n    <td class=\"gt_row gt_right\">98.12</td>\n    <td class=\"gt_row gt_right\">99.84</td>\n    <td class=\"gt_row gt_right\">76.94</td>\n    <td class=\"gt_row gt_right\">88.47</td>\n    <td class=\"gt_row gt_right\">100.0</td>\n    <td class=\"gt_row gt_right\">90.91</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 8</th>\n    <td class=\"gt_row gt_right\">95.83</td>\n    <td class=\"gt_row gt_right\">99.81</td>\n    <td class=\"gt_row gt_right\">55.56</td>\n    <td class=\"gt_row gt_right\">77.77</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 9</th>\n    <td class=\"gt_row gt_right\">96.77</td>\n    <td class=\"gt_row gt_right\">99.76</td>\n    <td class=\"gt_row gt_right\">56.07</td>\n    <td class=\"gt_row gt_right\">78.03</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 10</th>\n    <td class=\"gt_row gt_right\">97.39</td>\n    <td class=\"gt_row gt_right\">100.0</td>\n    <td class=\"gt_row gt_right\">74.11</td>\n    <td class=\"gt_row gt_right\">87.05</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">81.82</td>\n  </tr>\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"7\">AGGREGATE</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">0</th>\n    <td class=\"gt_row gt_right\">97.33</td>\n    <td class=\"gt_row gt_right\">99.92</td>\n    <td class=\"gt_row gt_right\">68.99</td>\n    <td class=\"gt_row gt_right\">84.49</td>\n    <td class=\"gt_row gt_right\">85.0</td>\n    <td class=\"gt_row gt_right\">80.18</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"7\">See benchmarks for how penalised group accuracy is calculated</td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\n::: {#b0c4ae5b .cell execution_count=12}\n``` {.python .cell-code}\nmodel = StatsModel(iqr_threshold=1.5,\n                   normal_z_threshold=3,\n                   rolling_z_threshold=3)\ncreate_benchmark_table(run_benchmark(model))\n\nX = test_files[1]['Value1']\ny = test_files[1]['Labels']\n\nmodel.fit(X)\ny_pred = model.predict(X)\n\npred_groups = np.array(Benchmarking.create_anomaly_groups(pd.Series(y_pred)))\ntrue_groups = np.array(Benchmarking.create_anomaly_groups(y))\n\nprint('Pred Groups\\n',pred_groups)\nprint('Actual Groups\\n',true_groups)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n=========================File 1==========================\n\n5 anomaly groups identified\n10 anomaly groups identified\nModel predicts 5 less than 10\nModel predicts 5 less than 10\n\n=========================File 2==========================\n\n8 anomaly groups identified\n10 anomaly groups identified\nModel predicts 2 less than 10\nModel predicts 2 less than 10\n\n=========================File 3==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 4==========================\n\n9 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 less than 10\nModel predicts 1 less than 10\n\n=========================File 5==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 6==========================\n\n10 anomaly groups identified\n10 anomaly groups identified\nNumber of groups match!\nNumber of groups match!\n\n=========================File 7==========================\n\n11 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 more than 10\nModel predicts 1 more than 10\n\n=========================File 8==========================\n\n12 anomaly groups identified\n10 anomaly groups identified\nModel predicts 2 more than 10\nModel predicts 2 more than 10\n\n=========================File 9==========================\n\n12 anomaly groups identified\n10 anomaly groups identified\nModel predicts 2 more than 10\nModel predicts 2 more than 10\n\n=========================File 10==========================\n\n7 anomaly groups identified\n10 anomaly groups identified\nModel predicts 3 less than 10\nModel predicts 3 less than 10\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div id=\"afyghsiefc\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#afyghsiefc table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#afyghsiefc thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#afyghsiefc p { margin: 0; padding: 0; }\n #afyghsiefc .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #afyghsiefc .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #afyghsiefc .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #afyghsiefc .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #afyghsiefc .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #afyghsiefc .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #afyghsiefc .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #afyghsiefc .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #afyghsiefc .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #afyghsiefc .gt_column_spanner_outer:first-child { padding-left: 0; }\n #afyghsiefc .gt_column_spanner_outer:last-child { padding-right: 0; }\n #afyghsiefc .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #afyghsiefc .gt_spanner_row { border-bottom-style: hidden; }\n #afyghsiefc .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #afyghsiefc .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }\n #afyghsiefc .gt_from_md> :first-child { margin-top: 0; }\n #afyghsiefc .gt_from_md> :last-child { margin-bottom: 0; }\n #afyghsiefc .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }\n #afyghsiefc .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }\n #afyghsiefc .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #afyghsiefc .gt_row_group_first td { border-top-width: 2px; }\n #afyghsiefc .gt_row_group_first th { border-top-width: 2px; }\n #afyghsiefc .gt_striped { background-color: rgba(128,128,128,0.05); }\n #afyghsiefc .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #afyghsiefc .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #afyghsiefc .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #afyghsiefc .gt_left { text-align: left; }\n #afyghsiefc .gt_center { text-align: center; }\n #afyghsiefc .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #afyghsiefc .gt_font_normal { font-weight: normal; }\n #afyghsiefc .gt_font_bold { font-weight: bold; }\n #afyghsiefc .gt_font_italic { font-style: italic; }\n #afyghsiefc .gt_super { font-size: 65%; }\n #afyghsiefc .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #afyghsiefc .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_title gt_font_normal\">Benchmark Results: <strong>Stats Model</strong></td>\n  </tr>\n  <tr class=\"gt_heading\">\n    <td colspan=\"7\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\">results <strong>before hyperparameter turning</strong></td>\n  </tr>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Accuracy\">Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Precision\">Precision</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Recall\">Recall</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Balanced-Accuracy\">Balanced Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Group-Accuracy\">Group Accuracy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Penalised-Group-Accuracy\">Penalised Group Accuracy</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"7\">File</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 1</th>\n    <td class=\"gt_row gt_right\">93.48</td>\n    <td class=\"gt_row gt_right\">99.59</td>\n    <td class=\"gt_row gt_right\">27.02</td>\n    <td class=\"gt_row gt_right\">63.5</td>\n    <td class=\"gt_row gt_right\">30.0</td>\n    <td class=\"gt_row gt_right\">15.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 2</th>\n    <td class=\"gt_row gt_right\">93.86</td>\n    <td class=\"gt_row gt_right\">99.78</td>\n    <td class=\"gt_row gt_right\">42.55</td>\n    <td class=\"gt_row gt_right\">71.27</td>\n    <td class=\"gt_row gt_right\">60.0</td>\n    <td class=\"gt_row gt_right\">48.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 3</th>\n    <td class=\"gt_row gt_right\">96.1</td>\n    <td class=\"gt_row gt_right\">99.75</td>\n    <td class=\"gt_row gt_right\">50.38</td>\n    <td class=\"gt_row gt_right\">75.19</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n    <td class=\"gt_row gt_right\">63.64</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 4</th>\n    <td class=\"gt_row gt_right\">95.96</td>\n    <td class=\"gt_row gt_right\">99.75</td>\n    <td class=\"gt_row gt_right\">49.88</td>\n    <td class=\"gt_row gt_right\">74.93</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n    <td class=\"gt_row gt_right\">63.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 5</th>\n    <td class=\"gt_row gt_right\">98.8</td>\n    <td class=\"gt_row gt_right\">99.74</td>\n    <td class=\"gt_row gt_right\">76.57</td>\n    <td class=\"gt_row gt_right\">88.28</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n    <td class=\"gt_row gt_right\">90.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 6</th>\n    <td class=\"gt_row gt_right\">93.91</td>\n    <td class=\"gt_row gt_right\">99.75</td>\n    <td class=\"gt_row gt_right\">39.44</td>\n    <td class=\"gt_row gt_right\">69.72</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n    <td class=\"gt_row gt_right\">70.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 7</th>\n    <td class=\"gt_row gt_right\">95.87</td>\n    <td class=\"gt_row gt_right\">99.5</td>\n    <td class=\"gt_row gt_right\">49.32</td>\n    <td class=\"gt_row gt_right\">74.65</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n    <td class=\"gt_row gt_right\">72.73</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 8</th>\n    <td class=\"gt_row gt_right\">95.17</td>\n    <td class=\"gt_row gt_right\">99.78</td>\n    <td class=\"gt_row gt_right\">48.5</td>\n    <td class=\"gt_row gt_right\">74.25</td>\n    <td class=\"gt_row gt_right\">60.0</td>\n    <td class=\"gt_row gt_right\">50.0</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 9</th>\n    <td class=\"gt_row gt_right\">96.47</td>\n    <td class=\"gt_row gt_right\">99.74</td>\n    <td class=\"gt_row gt_right\">51.98</td>\n    <td class=\"gt_row gt_right\">75.98</td>\n    <td class=\"gt_row gt_right\">80.0</td>\n    <td class=\"gt_row gt_right\">66.67</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">File 10</th>\n    <td class=\"gt_row gt_right\">94.71</td>\n    <td class=\"gt_row gt_right\">99.79</td>\n    <td class=\"gt_row gt_right\">47.62</td>\n    <td class=\"gt_row gt_right\">73.8</td>\n    <td class=\"gt_row gt_right\">50.0</td>\n    <td class=\"gt_row gt_right\">35.0</td>\n  </tr>\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"7\">AGGREGATE</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">0</th>\n    <td class=\"gt_row gt_right\">95.43</td>\n    <td class=\"gt_row gt_right\">99.72</td>\n    <td class=\"gt_row gt_right\">48.33</td>\n    <td class=\"gt_row gt_right\">74.16</td>\n    <td class=\"gt_row gt_right\">66.0</td>\n    <td class=\"gt_row gt_right\">57.4</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"7\">See benchmarks for how penalised group accuracy is calculated</td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n8 anomaly groups identified\n10 anomaly groups identified\nPred Groups\n [[2928 2979]\n [3834 3927]\n [4758 4879]\n [6850 6953]\n [7919 7955]\n [8379 8429]\n [9112 9221]\n [9403 9472]]\nActual Groups\n [[2206 2326]\n [2864 2979]\n [3483 3566]\n [3834 3927]\n [4758 4879]\n [6850 6958]\n [7852 7955]\n [8319 8429]\n [9112 9226]\n [9372 9472]]\n```\n:::\n:::\n\n\n::: {#7190b250 .cell execution_count=13}\n``` {.python .cell-code}\nfor file in test_files:\n  model = StatsModel().set_params(**best_balanced_acc_params)\n  X = file['Value1']\n  y = file['Labels']\n  model.fit(X)\n  y_pred = model.predict(X)\n\n  pred_groups = Benchmarking.create_anomaly_groups(pd.Series(y))\n  true_groups = Benchmarking.create_anomaly_groups(y)\n\n\n  plt.figure(figsize=(14,4))\n  plt.plot(X, color='black',lw=1)\n  #for start,end in true_groups:\n  #  plt.axvspan(start, end, color='green',alpha=0.3)\n\n  for start,end in pred_groups:\n    plt.axvspan(start,end, color='red',alpha=0.5)\n  plt.show()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-2.png){width=1098 height=337}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-4.png){width=1098 height=337}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-6.png){width=1098 height=337}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-8.png){width=1098 height=337}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-10.png){width=1098 height=337}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-12.png){width=1098 height=337}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-14.png){width=1098 height=337}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-16.png){width=1098 height=337}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-18.png){width=1098 height=337}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n10 anomaly groups identified\n10 anomaly groups identified\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-14-output-20.png){width=1098 height=337}\n:::\n:::\n\n\n::: {#3482fef1 .cell execution_count=14}\n``` {.python .cell-code}\nfrom sklearn.model_selection import LearningCurveDisplay\n\nLearningCurveDisplay.from_estimator(\n  StatsModel().set_params(**best_balanced_acc_params),\n  combined['Value1'],\n  combined['Labels']\n)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-15-output-1.png){width=597 height=429}\n:::\n:::\n\n\n::: {#1b2319f1 .cell execution_count=15}\n``` {.python .cell-code}\nLearningCurveDisplay.from_estimator(\n  StatsModel().set_params(**best_recall_params),\n  combined['Value1'],\n  combined['Labels']\n)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-16-output-1.png){width=597 height=429}\n:::\n:::\n\n\n::: {#a68408e2 .cell execution_count=16}\n``` {.python .cell-code}\nfrom sklearn.metrics import roc_curve\nfrom sklearn.metrics import RocCurveDisplay\n\nmodel = StatsModel().set_params(**best_balanced_acc_params)\n\nTest = combined[-20000:]\nmodel.fit(combined[:80000]['Value1'])\ny_pred = model.predict(Test['Value1'])\ny_true = Test[\"Labels\"]\nfpr, tpr, thresholds = roc_curve(y_true, y_pred)\n\nRocCurveDisplay.from_predictions(y_true, y_pred)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-17-output-1.png){width=445 height=431}\n:::\n:::\n\n\n::: {#3c5c9159 .cell execution_count=17}\n``` {.python .cell-code}\nfrom sklearn.metrics import PrecisionRecallDisplay\n\nPrecisionRecallDisplay.from_predictions(y_true, y_pred)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-18-output-1.png){width=445 height=431}\n:::\n:::\n\n\n::: {#fa6c9898 .cell execution_count=18}\n``` {.python .cell-code}\nmodel = StatsModel()\n\nfor idx, train in enumerate(train_files):\n  model = StatsModel()\n  model.fit(train['Value1'])\n  y_pred = model.predict(test_files[idx]['Value1'])\n\n  y_true= test_files[idx]['Labels']\n  results = Benchmarking.evaluate_model(y_true, y_pred)\n  print(results)\n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n2 anomaly groups identified\n10 anomaly groups identified\nModel predicts 8 less than 10\nModel predicts 8 less than 10\n                          Score\nAccuracy                   8.78\nPrecision                  8.79\nRecall                    98.43\nBalanced Accuracy         49.22\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n6 anomaly groups identified\n10 anomaly groups identified\nModel predicts 4 less than 10\nModel predicts 4 less than 10\n                          Score\nAccuracy                   8.13\nPrecision                  8.34\nRecall                    76.19\nBalanced Accuracy         38.10\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n4 anomaly groups identified\n10 anomaly groups identified\nModel predicts 6 less than 10\nModel predicts 6 less than 10\n                          Score\nAccuracy                   6.98\nPrecision                  7.04\nRecall                    89.03\nBalanced Accuracy         44.52\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n4 anomaly groups identified\n10 anomaly groups identified\nModel predicts 6 less than 10\nModel predicts 6 less than 10\n                          Score\nAccuracy                   7.71\nPrecision                  7.74\nRecall                    95.90\nBalanced Accuracy         47.95\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n7 anomaly groups identified\n10 anomaly groups identified\nModel predicts 3 less than 10\nModel predicts 3 less than 10\n                          Score\nAccuracy                   4.03\nPrecision                  4.07\nRecall                    79.33\nBalanced Accuracy         39.67\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n8 anomaly groups identified\n10 anomaly groups identified\nModel predicts 2 less than 10\nModel predicts 2 less than 10\n                          Score\nAccuracy                   8.34\nPrecision                  8.48\nRecall                    83.07\nBalanced Accuracy         41.53\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n7 anomaly groups identified\n10 anomaly groups identified\nModel predicts 3 less than 10\nModel predicts 3 less than 10\n                          Score\nAccuracy                   6.09\nPrecision                  6.22\nRecall                    75.09\nBalanced Accuracy         37.55\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n9 anomaly groups identified\n10 anomaly groups identified\nModel predicts 1 less than 10\nModel predicts 1 less than 10\n                          Score\nAccuracy                   7.26\nPrecision                  7.42\nRecall                    77.56\nBalanced Accuracy         38.78\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n1 anomaly groups identified\n10 anomaly groups identified\nModel predicts 9 less than 10\nModel predicts 9 less than 10\n                          Score\nAccuracy                   7.32\nPrecision                  7.32\nRecall                    99.86\nBalanced Accuracy         49.93\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n2 anomaly groups identified\n10 anomaly groups identified\nModel predicts 8 less than 10\nModel predicts 8 less than 10\n                          Score\nAccuracy                   9.63\nPrecision                  9.67\nRecall                    95.54\nBalanced Accuracy         47.77\nGroup Accuracy             0.00\nPenalised Group Accuracy   0.00\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}